{% extends "layout.html" %}
{% block content %}
<div class="Container">
<!-- This is the overview part of the media (Desc, Title, Poster) -->
  <div class="Details">
    <div class="title-poster">
        <h2>Episode {{ episode.episode_number }}: {{ episode.episode_name }}</h2>
        {% if episode.still_url %}
            <img src="{{ episode.still_url }}" alt="{{ episode.episode_name }}">
        {% endif %}
    </div> <!-- Title poster ends here-->
    <div class="Overview">
        <p>{{ episode.overview }}</p>
        <p><strong>Air Date:</strong> {{ episode.air_date }}</p>
        <p><strong>Rating:</strong> {{ episode.vote_average }}</p>
        {% if emoji_summary %}
          <p><strong>General Viewer Reaction:</strong> {{ emoji_summary }} </p>
        {% endif %}
    </div> <!-- Overview ends here-->


  </div><!-- Movie Details div ends here
  
  
  -->
    <hr>
<!-- Fake playback bar -->
    <div class="player">
        <button id="play-btn" type="button" class="play-btn" aria-label="Play">
        ‚ñ∂
        </button>
  
        <div id="progress-container"
            class="progress-container"
            data-duration="{{ episode.runtime*60 or 3600 }}">
        <div id="progress-bar" class="progress-bar"></div>
        <span id="progress-tooltip" class="progress-tooltip"></span>
        </div>
    </div> 
    <!--  End player div-->

{% if current_user.is_authenticated %}
  <h3>Add a Comment</h3>
  <form method="POST">
    {{ form.hidden_tag() }}

    <div>
      <label for="timestamp">{{ form.timestamp.label }}</label><br>
      {{ form.timestamp(size=10, placeholder="e.g., 01:23:45") }}
      {% for error in form.timestamp.errors %}
        <p style="color: red;">{{ error }}</p>
      {% endfor %}
    </div>

    <br>

    <div>
      <label for="content">{{ form.content.label }}</label><br>
      {{ form.content(rows=3, cols=40) }}
      {% for error in form.content.errors %}
        <p style="color: red;">{{ error }}</p>
      {% endfor %}
    </div>

    <br>
    {{ form.submit() }}
  </form>
{% else %}
  <p><a href="{{ url_for('login') }}">Log in</a> to leave a comment.</p>
{% endif %}
<button id="toggle-comments" class="toggle-btn">Show Comments</button>



<hr>



{% if comments %}
{% set count = comments|length %}
<h2>{{ count }} Comment{{ '' if count == 1 else 's' }}</h2>
<div id="comments-container" class="comments-container hidden">
    {% for comment in comments %}
      {% set hrs = comment.timestamp // 3600 %}
      {% set mins = (comment.timestamp % 3600) // 60 %}
      {% set secs = comment.timestamp % 60 %}
      <div class="comment" data-secs="{{ comment.timestamp }}">

        <div class="comment-header">
          <strong>{{ comment.user.username }}</strong> at
          <code>{{ "%02d:%02d:%02d"|format(hrs, mins, secs) }}</code>
        </div>
        <div class="comment-body">
          {{ comment.content }}
        </div>
          {% if current_user.is_authenticated and comment.user_id == current_user.id %}
            <form method="POST" action="{{ url_for('delete_comment', comment_id=comment.id) }}">
              <button type="submit" class="delete-comment">üóëÔ∏è</button>
            </form>
          {% endif %}
      </div>
    {% endfor %}  <!-- there was a random end div here -->
</div> <!-- comments-container end-->
{% else %}
<p>No comments yet.</p>
{% endif %}



</div> <!-- Main container end-->
{% endblock content %}

{% block scripts %}
<script src="{{ url_for('static', filename='progress_bar.js') }}"></script>
{% endblock scripts %}
