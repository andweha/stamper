{% extends "layout.html" %}
{% block content %}
<main class="main-container">
  <div class="Container">
    {% set is_anime = anime is defined %}
    {% set content = anime if is_anime else item %}

    {% if content %}
    <div class="Details">
      <!-- Poster -->
      <div class="title-poster">
        {% if content.poster_url or content.cover_url %}
        <img class="movie-poster"
             src="{{ content.poster_url or content.cover_url }}"
             alt="{{ content.title or content.title_english }}"
             width="300">
        {% endif %}
      </div>

      <!-- Text -->
      <div class="textual-info">
        <div class="title-row">
          <h2 class="movie-title" style="margin: 0;">
            {{ content.title or content.title_english }}
          </h2>
          <!-- Star button (uses media_id regardless of content type) -->
          <button class="star-button" data-show-id="{{ media_id }}">
            {% if media_id in user_favorites %}
              ⭐
            {% else %}
              ☆
            {% endif %}
          </button>
        </div>

        <div class="Overview">
          <p class="item-overview">
            {{ content.overview or content.description }}
          </p>
          {% if not is_anime %}
            <p><strong>📺 Type:</strong> {{ content.media_type|upper }}</p>
          {% endif %}
          <p><strong>📅 Release Date:</strong> {{ content.release_date or content.start_date }}</p>
          <p><strong>⭐ Rating:</strong> {{ content.vote_average or content.average_score }}</p>
        </div>
      </div>
    </div>
    {% else %}
    <h2>Media not found.</h2>
    {% endif %}

    <!-- Episodes / Seasons -->
    {% if is_anime and episodes %}
    <div class="seasons-button-grid">
      {% for episode in episodes %}
      <div class="season-block">
        <a href="{{ url_for('view_anime_episode', episode_id=episode.episode_id) }}">
          <button class="btn-season">{{ episode.episode_title }}</button>
        </a>
      </div>
      {% endfor %}
    </div>
    {% elif item and item.media_type == "tv" and seasons %}
    <div class="seasons-button-grid">
      {% for season in seasons %}
      <div class="season-block dropdown-container">
        <button class="btn-season">Season {{ season.season_number }}</button>
        <div class="dropdown-eps">
          <ul>
            {% for episode in season.episodes %}
            <li>
              <a href="{{ url_for('view_episode', episode_id=episode.episode_id) }}">Episode {{ episode.episode_number }}</a>
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}
  </div>
</main>
{% endblock content %}

{% block scripts %}
<script src="{{ url_for('static', filename='scripts/dropdown.js') }}"></script>
<script src="{{ url_for('static', filename='scripts/favorites.js') }}"></script>
{% endblock scripts %}
